// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN_AGENCY
  ASSISTANT
  AGENT
}
enum PropertyType {
  SALE
  RENT
  SHORT_TERM // Short-term rentals
  VACATION // Vacation rentals
}

model User {
  userId     Int       @id @default(autoincrement())
  email      String    @unique
  role       Role      @default(USER)
  firstName  String
  lastName   String
  phone      String?
  provider   String    @default("local")
  profilePic String?
  password   String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  sessions          Session[]
  agencyAdmin       AgencyAdmin?
  assistant         Assistant?
  agent             Agent?
  verificationCodes VerificationCode[]

  @@map("users")
}

model Session {
  sessionId  Int      @id @default(autoincrement())
  userId     Int
  user       User     @relation(fields: [userId], references: [userId])
  userAgent  String
  createdAt  DateTime @default(now())
  expiresAt  DateTime

  @@map("sessions")
}

model AgencyAdmin {
  userId Int   @id
  user   User  @relation(fields: [userId], references: [userId])
  agency Agency?

  @@map("agency_admins")
}

model Agency {
  agencyId     Int      @id @default(autoincrement())
  agencyAdminId      Int      @unique 
  agencyAdmin        AgencyAdmin    @relation(fields: [agencyAdminId], references: [userId])
  businessName String   // trade name
  legalName    String   // legal name
  vatNumber    String   // VAT number
  email        String   @unique
  pec          String?
  phone        String?
  website      String?
  address      String
  city         String
  postalCode   String   // cap
  province     String
  country      String
  latitude     Decimal?
  longitude    Decimal?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  assistants Assistant[] 
  agents     Agent[]
  properties Property[]
}

model Assistant {
  userId     Int    @id
  user       User   @relation(fields: [userId], references: [userId])
  agencyId   Int
  agency     Agency @relation(fields: [agencyId], references: [agencyId])

  @@map("assistants")
}

model Agent {
  userId     Int    @id
  user       User   @relation(fields: [userId], references: [userId])
  agencyId   Int
  agency     Agency @relation(fields: [agencyId], references: [agencyId])

  properties Property[]

  @@map("agents")
}

model VerificationCode {
  code       String   @id @default(uuid())
  userId     Int
  user       User     @relation(fields: [userId], references: [userId])
  type       String
  createdAt  DateTime @default(now())
  expiresAt  DateTime

  @@map("verification_codes")
}

model Property {
  propertyId   Int      @id @default(autoincrement())
  agencyId     Int
  agency       Agency   @relation(fields: [agencyId], references: [agencyId])
  agentId      Int
  agent        Agent    @relation(fields: [agentId], references: [userId])
  title        String   
  description  String
  price        Decimal
  surfaceArea  Int
  rooms        Int
  floors       Int
  elevator     Boolean
  energyClass  String
  concierge    Boolean
  airConditioning Boolean
  type         PropertyType
  address      String
  city         String
  postalCode   String
  province     String
  country      String
  latitude     Decimal
  longitude    Decimal
  images      PropertyImage[]
  @@map("properties")
}

model PropertyImage {
  imageId     Int      @id @default(autoincrement())
  propertyId  Int
  property    Property @relation(fields: [propertyId], references: [propertyId])
  url         String
  order       Int      
  createdAt   DateTime @default(now())

  @@map("property_images")
}