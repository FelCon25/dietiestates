generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  email             String             @unique
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  password          String
  userId            Int                @id @default(autoincrement())
  firstName         String
  lastName          String
  phone             String?
  profilePic        String?
  provider          String             @default("local")
  role              Role               @default(USER)
  savedSearches     SavedSearch[]
  agencyAdmin       AgencyAdmin?
  agent             Agent?
  assistant         Assistant?
  sessions          Session[]
  verificationCodes VerificationCode[]
  notificationPreferences UserNotificationPreference[]
  savedProperty SavedProperty[]

  @@map("users")
  
}

model Session {
  userId            Int
  userAgent         String
  createdAt         DateTime @default(now())
  expiresAt         DateTime
  notificationToken String?
  sessionId Int      @id @default(autoincrement())
  user      User     @relation(fields: [userId], references: [userId])

  @@map("sessions")
}

model AgencyAdmin {
  userId Int     @id
  agency Agency?
  user   User    @relation(fields: [userId], references: [userId])

  @@map("agency_admins")
}

model Agency {
  agencyId      Int         @id @default(autoincrement())
  businessName  String
  legalName     String
  vatNumber     String
  email         String      @unique
  pec           String?
  phone         String?
  website       String?
  address       String
  city          String
  postalCode    String
  province      String
  country       String
  latitude      Decimal
  longitude     Decimal
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  agencyAdminId Int         @unique
  agencyAdmin   AgencyAdmin @relation(fields: [agencyAdminId], references: [userId])
  agents        Agent[]
  assistants    Assistant[]
  properties    Property[]
}

model Assistant {
  userId   Int    @id
  agencyId Int
  agency   Agency @relation(fields: [agencyId], references: [agencyId])
  user     User   @relation(fields: [userId], references: [userId])

  @@map("assistants")
}

model Agent {
  userId     Int        @id
  agencyId   Int
  agency     Agency     @relation(fields: [agencyId], references: [agencyId])
  user       User       @relation(fields: [userId], references: [userId])
  properties Property[]

  @@map("agents")
}

model VerificationCode {
  code      String   @id @default(uuid())
  userId    Int
  type      String
  createdAt DateTime @default(now())
  expiresAt DateTime
  user      User     @relation(fields: [userId], references: [userId])

  @@map("verification_codes")
}

model Property {
  propertyId        Int             @id @default(autoincrement())
  agencyId          Int
  description       String
  price             Decimal
  surfaceArea       Int
  rooms             Int
  floors            Int
  elevator          Boolean
  energyClass       String
  concierge         Boolean
  airConditioning   Boolean
  insertionType     InsertionType
  propertyType      PropertyType        
  address           String
  city              String
  postalCode        String
  province          String
  country           String
  latitude          Decimal
  longitude         Decimal
  agentId           Int
  furnished         Boolean?
  propertyCondition PropertyCondition?
  createdAt         DateTime        @default(now())
  agency            Agency          @relation(fields: [agencyId], references: [agencyId])
  agent             Agent           @relation(fields: [agentId], references: [userId])
  images            PropertyImage[]
  savedProperty     SavedProperty[]

  @@map("properties")
}

model SavedSearch {
  searchId          Int           @id @default(autoincrement())
  userId            Int
  address           String?
  city              String?
  province          String?
  country           String?
  postalCode        String?
  latitude          Decimal?
  longitude         Decimal?
  radius            Int?
  minSurfaceArea    Int?
  maxSurfaceArea    Int?
  minRooms          Int?
  maxRooms          Int?
  propertyCondition PropertyCondition?//
  elevator          Boolean?
  airConditioning   Boolean?
  concierge         Boolean?
  energyClass       String?
  furnished         Boolean?//
  propertyType      PropertyType?//
  insertionType     InsertionType?
  minPrice          Decimal?
  maxPrice          Decimal?
  name              String
  user              User          @relation(fields: [userId], references: [userId])
}

model PropertyImage {
  imageId    Int      @id @default(autoincrement())
  propertyId Int
  url        String
  order      Int
  createdAt  DateTime @default(now())
  property   Property @relation(fields: [propertyId], references: [propertyId])

  @@map("property_images")
}

model SavedProperty {
  userId     Int
  propertyId Int
  savedAt    DateTime @default(now())
  user       User     @relation(fields: [userId], references: [userId])
  property   Property @relation(fields: [propertyId], references: [propertyId])

  @@id([userId, propertyId])
  @@map("saved_properties")
}

model UserNotificationPreference {
  userId             Int
  category           NotificationCategory
  user               User             @relation(fields: [userId], references: [userId])

  @@id([userId, category])
  @@map("user_notification_preferences")
}

enum Role {
  USER
  ASSISTANT
  AGENT
  ADMIN_AGENCY
}

enum PropertyCondition {
  NEW
  GOOD_CONDITION
  TO_RENOVATE
}

enum InsertionType {
  SALE
  RENT
  SHORT_TERM
  VACATION
}

enum PropertyType {
  VILLA
  APARTMENT
  STUDIO
  GARAGE
}

enum NotificationCategory {
  PROMOTIONAL
  NEW_PROPERTY_MATCH
}